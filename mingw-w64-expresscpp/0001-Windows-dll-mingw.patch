From 646f3423e24d01eac8b98b4158334cb725374c37 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Matheus=20Catarino=20Fran=C3=A7a?=
 <matheus-catarino@hotmail.com>
Date: Sat, 12 Dec 2020 11:51:28 -0300
Subject: [PATCH] Windows dll - mingw
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Matheus Catarino Fran√ßa <matheus-catarino@hotmail.com>
---
 CMakeLists.txt     | 4 ++++
 src/expresscpp.cpp | 2 +-
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 7e5dfbb..4047955 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -80,6 +80,10 @@ if(NOT BUILD_SHARED_LIBS)
   set(BUILD_SHARED_LIBS OFF)
 endif()
 
+if(WIN32)
+ link_libraries(ws2_32 mswsock Bcrypt)
+endif()
+
 if(EXPRESSCPP_ENABLE_COVERAGE)
   if(NOT CMAKE_BUILD_TYPE STREQUAL "Debug")
     message(WARNING "Code coverage results with an optimised (non-Debug) build may be misleading")
diff --git a/src/expresscpp.cpp b/src/expresscpp.cpp
index 985f71d..9232ff9 100644
--- a/src/expresscpp.cpp
+++ b/src/expresscpp.cpp
@@ -147,7 +147,7 @@ void ExpressCpp::HandleRequest(request_t req, response_t res, std::function<void
     auto eptr = std::current_exception();
     if (error_handler_registered_) {
       expresscpp::NextRouter next;
-      auto ec = std::make_error_code(std::errc::no_message);
+      auto ec = std::make_error_code(std::errc::bad_message);
       error_handler_(ec, req, res, next);
     } else {
       std::rethrow_exception(eptr);
-- 
2.29.2

